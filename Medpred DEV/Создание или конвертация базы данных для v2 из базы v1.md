Предполагаем, что платформа для разработки называется ***`dev`***

## Если нужна чистая база
- Настраиваем `config.js`, в него нужно внести название платформы. Для примера возьмем название `testtesttest`

- Создаем платформу из новой миграции:
```sh
tools/cli.js server make-platform testtesttest --initDbFromMigration --useDefaultValues
```

- Делаем дамп базы testtesttest и заливаем ее на чистую базу в разработке

- Запускаем миграции для v2
```sh
./cli artisan migrate -p dev
```

- Запускаем сидер для создания вьюхи для v2
```sh
./cli artisan -p dev db:seed ViewSeeder
```

## Если нужно мигрировать базу первой версии во вторую
- Запускаем миграции для первой версии (если они еще не применены)
```sh
./cli v1-artisan migrate -p dev
```

- Запускаем миграции для второй версии
```sh
./cli artisan migrate -p dev
```

- Запускаем сидер для создания вьюхи для v2
```sh
./cli artisan -p dev db:seed ViewSeeder
```

- Запускаем конвертацию адресов первой версии во вторую
```sh
./cli artisan -p dev once:migrate-from-geo-address
```

- Запускаем удаление устаревших полей
```sh
./cli v1-artisan -p dev medpred-util:delete-deprecated-db
```

Если упадет с ошибкой, нужно поправить юзера для вьюшки на которой упал скрипт.
Скорее всего упадет на `view_rel_person_geo_ids`

SQL запрос будет следующим:

```sql
CREATE OR REPLACE ALGORITHM = UNDEFINED DEFINER = `УКАЖИТЕ_ПОЛЬЗОВАТЕЛЯ_БД_ЗДЕСЬ`@`localhost` SQL SECURITY DEFINER VIEW `medpred`.`view_rel_person_geo_ids` AS select `rel_person_object`.`person_id` AS `person_id`,`rel_person_object`.`object_id` AS `object_id`,`objects`.`address_id` AS `geo_address_id`,`geo_address`.`country_id` AS `country_id`,`geo_address`.`federal_id` AS `federal_id`,`geo_address`.`region_id` AS `region_id`,`geo_address`.`area_id` AS `area_id`,`geo_address`.`parent_city_id` AS `parent_city_id`,`geo_address`.`city_id` AS `city_id`,`geo_address`.`city_area_id` AS `city_area_id`,`geo_address`.`district_id` AS `district_id`,`geo_address`.`street_id` AS `street_id` from ((`rel_person_object` left join `objects` on((`objects`.`id` = `rel_person_object`.`object_id`))) left join `geo_address` on((`geo_address`.`id` = `objects`.`address_id`)));
```
Нужно заменить УКАЖИТЕ_ПОЛЬЗОВАТЕЛЯ_БД_ЗДЕСЬ на действующего пользователя